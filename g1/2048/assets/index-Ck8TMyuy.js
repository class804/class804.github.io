(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const r of o)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&s(n)}).observe(document,{childList:!0,subtree:!0});function t(o){const r={};return o.integrity&&(r.integrity=o.integrity),o.referrerPolicy&&(r.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?r.credentials="include":o.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(o){if(o.ep)return;o.ep=!0;const r=t(o);fetch(o.href,r)}})();class x{constructor(e){this.size=e,this.cells=this.empty()}empty(){const e=[];for(let t=0;t<this.size;t++){const s=[];for(let o=0;o<this.size;o++)s.push(null);e.push(s)}return e}randomAvailableCell(){const e=this.availableCells();if(e.length)return e[Math.floor(Math.random()*e.length)]}availableCells(){const e=[];return this.eachCell((t,s,o)=>{o||e.push({x:t,y:s})}),e}eachCell(e){for(let t=0;t<this.size;t++)for(let s=0;s<this.size;s++)e(t,s,this.cells[t][s])}cellsAvailable(){return!!this.availableCells().length}cellAvailable(e){return!this.cellOccupied(e)}cellOccupied(e){return!!this.cellContent(e)}cellContent(e){return this.withinBounds(e)?this.cells[e.x][e.y]:null}insertTile(e){this.cells[e.x][e.y]=e}removeTile(e){this.cells[e.x][e.y]=null}withinBounds(e){return e.x>=0&&e.x<this.size&&e.y>=0&&e.y<this.size}}class v{constructor(e,t=2){this.x=e.x,this.y=e.y,this.value=t,this.previousPosition=null,this.mergedFrom=null}savePosition(){this.previousPosition={x:this.x,y:this.y}}updatePosition(e){this.x=e.x,this.y=e.y}}class C{constructor(e){this.size=e,this.startTiles=2,this.setup()}setup(){this.grid=new x(this.size),this.score=0,this.deltaScore=0,this.bestScore=localStorage.getItem("bestScore")||0,this.over=!1,this.won=!1,this.tileContainer=document.querySelector(".tile-container"),this.scoreContainer=document.querySelector(".score-container"),this.bestContainer=document.querySelector(".best-container"),this.messageContainer=document.querySelector(".game-message"),this.addStartTiles(),this.actuate(),this.input()}input(){const e={38:0,39:1,40:2,37:3,75:0,76:1,74:2,72:3,87:0,68:1,83:2,65:3};document.addEventListener("keydown",i=>{const h=i.altKey||i.ctrlKey||i.metaKey||i.shiftKey,c=e[i.which];h||c!==void 0&&(i.preventDefault(),this.move(c)),!h&&i.which===82&&window.location.reload()});let t,s,o;window.navigator.msPointerEnabled?(t="MSPointerDown",s="MSPointerMove",o="MSPointerUp"):(t="touchstart",s="touchmove",o="touchend");let r,n;const a=document.getElementsByClassName("game-container")[0];a.addEventListener(t,i=>{!window.navigator.msPointerEnabled&&i.touches.length>1||i.targetTouches>1||(window.navigator.msPointerEnabled?(r=i.pageX,n=i.pageY):(r=i.touches[0].clientX,n=i.touches[0].clientY),i.preventDefault())}),a.addEventListener(s,i=>{i.preventDefault()}),a.addEventListener(o,i=>{if(!window.navigator.msPointerEnabled&&i.touches.length>0||i.targetTouches>0)return;let h,c;window.navigator.msPointerEnabled?(h=i.pageX,c=i.pageY):(h=i.changedTouches[0].clientX,c=i.changedTouches[0].clientY);const u=h-r,m=Math.abs(u),g=c-n,y=Math.abs(g);Math.max(m,y)>10&&this.move(m>y?u>0?1:3:g>0?2:0)});let f,d,l=!1;a.addEventListener("mousedown",i=>{f=i.clientX,d=i.clientY,l=!0}),a.addEventListener("mousemove",i=>{i.preventDefault()}),a.addEventListener("mouseup",i=>{if(!l)return;l=!1;const h=i.clientX-f,c=i.clientY-d,u=Math.abs(h),m=Math.abs(c);Math.max(u,m)>10&&this.move(u>m?h>0?1:3:c>0?2:0)}),a.addEventListener("mouseleave",()=>{l=!1})}actuate(){this.bestScore<this.score&&(this.bestScore=this.score,localStorage.setItem("bestScore",this.bestScore)),window.requestAnimationFrame(()=>{this.clearContainer(this.tileContainer),this.grid.cells.forEach(e=>{e.forEach(t=>{t&&this.addTile(t)})}),this.updateScore(),this.updateBestScore(),(this.over||this.won)&&(this.over?this.message(!1):this.won&&this.message(!0))})}clearContainer(e){for(;e.firstChild;)e.removeChild(e.firstChild)}addTile(e){const t=document.createElement("div"),s=document.createElement("div"),o=e.previousPosition||{x:e.x,y:e.y},r=this.positionClass(o),n=["tile",`tile-${e.value}`,r];e.value>2048&&n.push("tile-super"),this.applyClasses(t,n),s.classList.add("tile-inner"),s.textContent=e.value,e.previousPosition?window.requestAnimationFrame(()=>{n[2]=this.positionClass({x:e.x,y:e.y}),this.applyClasses(t,n)}):e.mergedFrom?(n.push("tile-merged"),this.applyClasses(t,n),e.mergedFrom.forEach(a=>{this.addTile(a)})):(n.push("tile-new"),this.applyClasses(t,n)),t.appendChild(s),this.tileContainer.appendChild(t)}applyClasses(e,t){e.setAttribute("class",t.join(" "))}normalizePosition(e){return{x:e.x+1,y:e.y+1}}positionClass(e){return e=this.normalizePosition(e),`tile-position-${e.x}-${e.y}`}updateScore(){if(this.clearContainer(this.scoreContainer),this.scoreContainer.textContent=this.score,this.deltaScore>0){const e=document.createElement("div");e.classList.add("score-addition"),e.textContent=`+${this.deltaScore}`,this.scoreContainer.appendChild(e)}this.deltaScore=0}updateBestScore(){this.bestContainer.textContent=this.bestScore}message(e){const t=e?"game-won":"game-over",s=e?"You win!":"Game over!";this.messageContainer.classList.add(t),this.messageContainer.getElementsByTagName("p")[0].textContent=s}addStartTiles(){for(let e=0;e<this.startTiles;e++)this.addRandomTile()}addRandomTile(){if(this.grid.cellsAvailable()){const e=Math.random()<.9?2:4,t=new v(this.grid.randomAvailableCell(),e);this.grid.insertTile(t)}}prepareTiles(){this.grid.eachCell((e,t,s)=>{s&&(s.mergedFrom=null,s.savePosition())})}moveTile(e,t){this.grid.cells[e.x][e.y]=null,this.grid.cells[t.x][t.y]=e,e.updatePosition(t)}move(e){if(this.over||this.won)return;let t,s;const o=this.getVector(e),r=this.buildTraversals(o);let n=!1;this.deltaScore=0,this.prepareTiles(),r.x.forEach(a=>{r.y.forEach(f=>{if(t={x:a,y:f},s=this.grid.cellContent(t),s){const d=this.findFarthestPosition(t,o),l=this.grid.cellContent(d.next);if(l&&l.value===s.value&&!l.mergedFrom){const i=new v(d.next,s.value*2);i.mergedFrom=[s,l],this.grid.insertTile(i),this.grid.removeTile(s),s.updatePosition(d.next),this.deltaScore+=i.value,this.score+=i.value,i.value===2048&&(this.won=!0)}else this.moveTile(s,d.farthest);this.positionsEqual(t,s)||(n=!0)}})}),n&&(this.addRandomTile(),this.movesAvailable()||(this.over=!0),this.actuate())}getVector(e){return{0:{x:0,y:-1},1:{x:1,y:0},2:{x:0,y:1},3:{x:-1,y:0}}[e]}buildTraversals(e){const t={x:[],y:[]};for(let s=0;s<this.size;s++)t.x.push(s),t.y.push(s);return e.x===1&&t.x.reverse(),e.y===1&&t.y.reverse(),t}findFarthestPosition(e,t){let s;do s=e,e={x:s.x+t.x,y:s.y+t.y};while(this.grid.withinBounds(e)&&this.grid.cellAvailable(e));return{farthest:s,next:e}}movesAvailable(){return this.grid.cellsAvailable()||this.tileMatchesAvailable()}tileMatchesAvailable(){for(let e=0;e<this.size;e++)for(let t=0;t<this.size;t++){const s=this.grid.cellContent({x:e,y:t});if(s)for(let o=0;o<4;o++){const r=this.getVector(o),n={x:e+r.x,y:t+r.y},a=this.grid.cellContent(n);if(a&&a.value===s.value)return!0}}return!1}positionsEqual(e,t){return e.x===t.x&&e.y===t.y}}window.requestAnimationFrame(function(){new C(4)});
